{% load static %}

<!doctype html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css' rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  {% block title %}
  {% include "bootstrap/navbar.html" with brand_name="eCommerce" %}

  <title>{{ brand_name }}</title>
  {% endblock title %}

</head>

<body>

  {% block content %}

  {% endblock content %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous">
  </script>

  <script>
    $(document).ready(function(){
      const productForm = $(`#form-product-ajax`)

    productForm.submit(function(event) {
      event.preventDefault();
      const thisForm = $(this)
      const action = thisForm.attr('action')
      const method = thisForm.attr('method')
      const formData = thisForm.serialize()
      const actionEndpoint = thisForm.attr('data-endpoint')
      
      $.ajax({
        url: action,
        method: "POST",
        data: formData,
        success: function (data) {
          console.log('Success', data)
          const submitSpan = thisForm.find('.submit-span')
          if (data.added){
            submitSpan.html('In cart <button type="submit" class="btn btn-danger">Remove</button>')
          
        } else {
            submitSpan.html('<button type="submit" class="btn btn-primary">Add to cart</button>')
        }
        let navbarCounter = $('.navbar-cart-count')
        navbarCounter.text(data.cartItemCount)
        let currentPath = window.location.href
        if(currentPath.indexOf('cart') != -1){
          updateCart()
        }
      },
        error: function (errorData) {
          console.log('An error occured - ', errorData)
        }

      })

    })
    function updateCart(){
      console.log('In current cart')
      const cartTable = $('.cart-table')
      const cartBody = cartTable.find('.cart-body')
      cartBody.html('<h1> Changed </h1>')
      let updateCartUrl = '/api/cart/'
      let updateCartMethod = "GET"
      let data = {}
      $.ajax({
        url: updateCartUrl, 
        method: updateCartMethod,
        data: data,
        success: function(data){
          console.log('success')
        },
        error: function(errorData){
          console.log('error')
        }
      
      })
    
    }

    
  
  })
  </script>


</body>

</html>